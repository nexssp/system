const{spawnSync:spawnSync,execSync:execSync}=require("child_process"),{existsSync:existsSync}=require("fs");function debugOutput(r,e,s,t){e.stdio||(e.stdio="pipe"),console.log(t?"\nResult WITH STDERR:":`\nResult WITHOUT STDERR:\nExecuted: ${r}\nOptions: `,e,`process.cwd(): ${process.cwd()}`,"\nSTDOUT:\n",s,"|END STDOUT"),t&&console.error(t)}function nExec(r,e){const s=(e=parseOptions(e)).stripTerminalColors;delete e.stripTerminalColors;let t="",o="";try{return t=execSync(r,e),t=t.toString(),s&&(t=t.stripTerminalColors()),{exitCode:0,stdout:t,stderr:"",command:r}}catch(n){return n.stdout&&(t=n.stdout.toString()),n.stderr&&(o=n.stderr.toString()),s&&(t=t.stripTerminalColors(),o=o.stripTerminalColors()),nExec.debug&&debugOutput(r,e,t,o),{exitCode:n.status,stdout:t,stderr:o,command:r}}}require("@nexssp/extend")("array");const parseOptions=(r={})=>(r.stdio||(r.stdio="pipe"),"win32"!==process.platform?Object.assign(r,{shell:process.shell}):Object.assign(r,{shell:!0}),r.cwd&&!existsSync(r.cwd)?new Error("Folder passed to 'nSpawn' does not exist."):r);function nSpawn(r,e={}){const{parseArgsStringToArgv:s}=require("string-argv");let t=s(r);t=t.argvAddQuotes();const[o,...n]=t;nSpawn.debug&&(console.log("command:",r),console.log("cmd:",o),console.log("args:",n)),e=parseOptions(e),"win32"===process.platform?e.shell=!0:e.shell=require("@nexssp/os").getShell();const c=e.stripTerminalColors;delete e.stripTerminalColors;let i,d="",l="",a=0;try{i=spawnSync(`${o}`,n,e)}catch(r){console.log("Error catched:",r),process.exit(1)}if(!i.error)return i.stdout&&(l=i.stdout.toString()),i.stderr&&(d=i.stderr.toString()),i.status&&(a=i.status),c&&(l=l.stripTerminalColors(),d=d.stripTerminalColors()),nSpawn.debug&&debugOutput(r,e,l,d),{exitCode:a,stdout:l,stderr:d,cmd:o,args:n,command:r};switch(i.error.code){case"ENOENT":throw new Error(`Program has not been found: ${i.error}, path: ${i.error.path}.`);case"EACCES":throw new Error(`Permission denied: ${i.error}, path: ${i.error.path}`);default:throw new Error(i.error)}}nSpawn.debug=!1,module.exports={nSpawn:nSpawn,nExec:nExec};